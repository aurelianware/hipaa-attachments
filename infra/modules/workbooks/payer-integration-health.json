{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## Payer Integration Health Dashboard\n\n**Per-payer monitoring of EDI transaction health and integration status**\n\n⚠️ **PHI Redaction Active**: All patient identifiers are automatically redacted.\n\n---"
      },
      "name": "header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "timeRange",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "label": "Time Range",
            "type": 4,
            "isRequired": true,
            "value": {
              "durationMs": 86400000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 14400000
                },
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 2592000000
                }
              ],
              "allowCustom": true
            }
          },
          {
            "id": "payerId",
            "version": "KqlParameterItem/1.0",
            "name": "PayerId",
            "label": "Payer ID",
            "type": 2,
            "isRequired": true,
            "query": "requests\n| where timestamp {TimeRange}\n| where customDimensions.payerId != ''\n| distinct tostring(customDimensions.payerId)\n| order by customDimensions_payerId asc",
            "typeSettings": {
              "showDefault": false
            },
            "timeContext": {
              "durationMs": 0
            },
            "timeContextFromParameter": "TimeRange",
            "queryType": 0,
            "resourceType": "microsoft.insights/components"
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.insights/components"
      },
      "name": "parameters"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let payerData = requests\n| where timestamp {TimeRange}\n| where tostring(customDimensions.payerId) == '{PayerId}'\n| summarize \n    TotalTransactions = count(),\n    SuccessfulTransactions = countif(success == true),\n    FailedTransactions = countif(success == false),\n    AvgDurationMs = avg(duration),\n    P95DurationMs = percentile(duration, 95),\n    LastTransaction = max(timestamp);\nlet healthScore = payerData\n| extend \n    SuccessRate = 100.0 * SuccessfulTransactions / TotalTransactions,\n    LatencyScore = case(\n        P95DurationMs < 2000, 100,\n        P95DurationMs < 5000, 75,\n        P95DurationMs < 10000, 50,\n        25\n    ),\n    VolumeScore = case(\n        TotalTransactions > 100, 100,\n        TotalTransactions > 50, 75,\n        TotalTransactions > 10, 50,\n        25\n    ),\n    FreshnessScore = case(\n        datetime_diff('minute', now(), LastTransaction) < 60, 100,\n        datetime_diff('minute', now(), LastTransaction) < 240, 75,\n        datetime_diff('minute', now(), LastTransaction) < 1440, 50,\n        25\n    )\n| extend OverallHealth = round((SuccessRate + LatencyScore + VolumeScore + FreshnessScore) / 4, 1);\npayerData\n| join kind=inner healthScore on TotalTransactions\n| project \n    PayerId = '{PayerId}',\n    OverallHealth = strcat(OverallHealth, '%'),\n    TotalTransactions,\n    SuccessRate = strcat(round(SuccessRate, 1), '%'),\n    AvgDurationMs = round(AvgDurationMs, 0),\n    P95DurationMs = round(P95DurationMs, 0),\n    LastTransaction",
        "size": 4,
        "title": "Payer Health Summary",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "PayerId",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "OverallHealth",
            "formatter": 12,
            "formatOptions": {
              "palette": "greenRed"
            }
          },
          "secondaryContent": {
            "columnMatch": "TotalTransactions",
            "formatter": 12,
            "formatOptions": {
              "palette": "blue"
            }
          },
          "showBorder": true
        }
      },
      "name": "payerHealthSummary"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "requests\n| where timestamp {TimeRange}\n| where tostring(customDimensions.payerId) == '{PayerId}'\n| summarize \n    Count = count(),\n    Successful = countif(success == true),\n    Failed = countif(success == false)\n    by TransactionType = tostring(customDimensions.transactionType)\n| extend SuccessRate = round(100.0 * Successful / Count, 1)\n| project TransactionType, Count, Successful, Failed, SuccessRate\n| order by Count desc",
        "size": 0,
        "title": "Transaction Types for {PayerId}",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Count",
              "formatter": 8,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "SuccessRate",
              "formatter": 8,
              "formatOptions": {
                "palette": "greenRed",
                "min": 0,
                "max": 100
              }
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "transactionTypesTable"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "requests\n| where timestamp {TimeRange}\n| where tostring(customDimensions.payerId) == '{PayerId}'\n| summarize Count = count() by bin(timestamp, 1h), success\n| extend Status = case(success == true, 'Success', 'Failed')\n| project timestamp, Status, Count\n| order by timestamp asc",
        "size": 0,
        "title": "Hourly Transaction Volume",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "visualization": "barchart"
      },
      "customWidth": "50",
      "name": "hourlyVolumeChart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "requests\n| where timestamp {TimeRange}\n| where tostring(customDimensions.payerId) == '{PayerId}'\n| summarize \n    AvgDuration = avg(duration),\n    P50Duration = percentile(duration, 50),\n    P95Duration = percentile(duration, 95),\n    P99Duration = percentile(duration, 99)\n    by bin(timestamp, 15m), tostring(customDimensions.transactionType)\n| project timestamp, TransactionType = customDimensions_transactionType, AvgDuration, P50Duration, P95Duration, P99Duration\n| order by timestamp asc",
        "size": 0,
        "title": "Latency Trends by Transaction Type",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "visualization": "linechart"
      },
      "name": "latencyTrendsChart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "dependencies\n| where timestamp {TimeRange}\n| where tostring(customDimensions.payerId) == '{PayerId}'\n| summarize \n    CallCount = count(),\n    AvgDuration = avg(duration),\n    SuccessRate = 100.0 * countif(success == true) / count()\n    by DependencyType = type, DependencyName = name\n| extend \n    Status = case(\n        SuccessRate >= 99, '✅ Healthy',\n        SuccessRate >= 95, '⚠️ Warning',\n        '❌ Critical'\n    )\n| project Status, DependencyType, DependencyName, CallCount, AvgDuration = round(AvgDuration, 2), SuccessRate = round(SuccessRate, 2)\n| order by SuccessRate asc",
        "size": 0,
        "title": "Backend Integration Status",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Status",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "contains",
                    "thresholdValue": "Healthy",
                    "representation": "success",
                    "text": ""
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Warning",
                    "representation": "warning",
                    "text": ""
                  },
                  {
                    "operator": "contains",
                    "thresholdValue": "Critical",
                    "representation": "failed",
                    "text": ""
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "unknown",
                    "text": ""
                  }
                ]
              }
            },
            {
              "columnMatch": "CallCount",
              "formatter": 8,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "SuccessRate",
              "formatter": 8,
              "formatOptions": {
                "palette": "greenRed",
                "min": 0,
                "max": 100
              }
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "backendIntegrationTable"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "requests\n| where timestamp {TimeRange}\n| where tostring(customDimensions.payerId) == '{PayerId}'\n| where success == false\n| extend \n    ErrorType = case(\n        resultCode startswith '4', 'Client Error',\n        resultCode startswith '5', 'Server Error',\n        'Other Error'\n    )\n| summarize ErrorCount = count() by ErrorType, resultCode\n| order by ErrorCount desc",
        "size": 0,
        "title": "Error Distribution",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "visualization": "piechart"
      },
      "customWidth": "50",
      "name": "errorDistributionChart"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "requests\n| where timestamp {TimeRange}\n| where tostring(customDimensions.payerId) == '{PayerId}'\n| where success == false\n| extend \n    WorkflowName = name,\n    ErrorCode = resultCode,\n    ErrorMessage = tostring(customDimensions.errorMessage),\n    TransactionType = tostring(customDimensions.transactionType)\n| project \n    timestamp,\n    WorkflowName,\n    TransactionType,\n    ErrorCode,\n    ErrorMessage = substring(ErrorMessage, 0, 150),\n    Duration = duration\n| order by timestamp desc\n| take 100",
        "size": 0,
        "title": "Recent Errors for {PayerId} (Last 100)",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "timestamp",
              "formatter": 6
            },
            {
              "columnMatch": "ErrorCode",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "redBright",
                    "text": "{0}{1}"
                  }
                ]
              }
            }
          ],
          "filter": true
        }
      },
      "name": "recentErrorsTable"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "customEvents\n| where timestamp {TimeRange}\n| where tostring(customDimensions.payerId) == '{PayerId}'\n| where name in ('X12_Decode_Success', 'X12_Encode_Success', 'SFTP_Upload_Success', 'ServiceBus_Message_Sent')\n| summarize EventCount = count() by EventName = name, bin(timestamp, 1h)\n| project timestamp, EventName, EventCount\n| order by timestamp asc",
        "size": 0,
        "title": "Integration Events Timeline",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.insights/components",
        "visualization": "timechart"
      },
      "name": "integrationEventsChart"
    },
    {
      "type": 1,
      "content": {
        "json": "---\n\n### Health Score Calculation\n\n**Overall Health** is calculated from four components:\n\n1. **Success Rate** (0-100%): Percentage of successful transactions\n2. **Latency Score**: Based on P95 latency\n   - <2s: 100, <5s: 75, <10s: 50, >10s: 25\n3. **Volume Score**: Based on transaction volume\n   - >100: 100, >50: 75, >10: 50, <10: 25\n4. **Freshness Score**: Based on time since last transaction\n   - <1h: 100, <4h: 75, <24h: 50, >24h: 25\n\n⚠️ **Recommended Actions**:\n- Health < 70%: Investigate immediately\n- Success Rate < 95%: Review error logs\n- P95 Latency > 5s: Check backend systems\n- No transactions in 24h: Verify integration status"
      },
      "name": "footer"
    }
  ],
  "fallbackResourceIds": [],
  "fromTemplateId": "sentinel-UserWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
