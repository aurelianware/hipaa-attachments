{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://aurelianware.com/schemas/auth-request-referral.json",
  "title": "Referral Authorization Request (X12 278 X217 - UM01=SC)",
  "description": "Schema for referral authorization requests supporting X12 278 Specialty Care Review",
  "type": "object",
  "required": ["patient", "requestingProvider", "referredToProvider", "diagnosis"],
  "properties": {
    "patient": {
      "type": "object",
      "required": ["memberId", "dateOfBirth", "gender"],
      "properties": {
        "memberId": {"type": "string", "pattern": "^[A-Z0-9]{1,80}$"},
        "firstName": {"type": "string", "maxLength": 35},
        "lastName": {"type": "string", "maxLength": 60},
        "dateOfBirth": {"type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$"},
        "gender": {"type": "string", "enum": ["M", "F", "U"]},
        "relationship": {"type": "string", "enum": ["01", "18", "19", "20", "21"]}
      }
    },
    "subscriber": {
      "type": "object",
      "properties": {
        "memberId": {"type": "string", "pattern": "^[A-Z0-9]{1,80}$"},
        "firstName": {"type": "string", "maxLength": 35},
        "lastName": {"type": "string", "maxLength": 60}
      }
    },
    "requestingProvider": {
      "type": "object",
      "required": ["npi"],
      "description": "Referring provider (e.g., PCP)",
      "properties": {
        "npi": {"type": "string", "pattern": "^\\d{10}$"},
        "firstName": {"type": "string", "maxLength": 35},
        "lastName": {"type": "string", "maxLength": 60},
        "organizationName": {"type": "string", "maxLength": 60},
        "address": {
          "type": "object",
          "properties": {
            "street1": {"type": "string", "maxLength": 55},
            "city": {"type": "string", "maxLength": 30},
            "state": {"type": "string", "pattern": "^[A-Z]{2}$"},
            "zipCode": {"type": "string", "pattern": "^\\d{5}(-\\d{4})?$"}
          }
        },
        "phone": {"type": "string", "pattern": "^\\d{10}$"}
      }
    },
    "referredToProvider": {
      "type": "object",
      "required": ["npi"],
      "description": "Specialist or facility being referred to (NM101=SJ in 2000EA loop)",
      "properties": {
        "npi": {
          "type": "string",
          "pattern": "^\\d{10}$",
          "description": "Specialist NPI"
        },
        "firstName": {
          "type": "string",
          "maxLength": 35,
          "description": "Specialist first name (for individual providers)"
        },
        "lastName": {
          "type": "string",
          "maxLength": 60,
          "description": "Specialist last name (for individual providers)"
        },
        "organizationName": {
          "type": "string",
          "maxLength": 60,
          "description": "Facility or practice name (for organizational providers)"
        },
        "specialty": {
          "type": "string",
          "maxLength": 50,
          "description": "Provider specialty (e.g., Cardiology, Orthopedics)"
        },
        "taxonomy": {
          "type": "string",
          "pattern": "^[0-9X]{10}$",
          "description": "NUCC provider taxonomy code (PRV*RF*PXC segment)"
        },
        "address": {
          "type": "object",
          "properties": {
            "street1": {"type": "string", "maxLength": 55},
            "city": {"type": "string", "maxLength": 30},
            "state": {"type": "string", "pattern": "^[A-Z]{2}$"},
            "zipCode": {"type": "string", "pattern": "^\\d{5}(-\\d{4})?$"}
          }
        }
      }
    },
    "serviceDateRange": {
      "type": "object",
      "description": "Service date range (optional for referrals)",
      "properties": {
        "fromDate": {"type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$"},
        "toDate": {"type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$"}
      }
    },
    "diagnosis": {
      "type": "array",
      "minItems": 1,
      "maxItems": 12,
      "items": {
        "type": "object",
        "required": ["code"],
        "properties": {
          "code": {"type": "string", "pattern": "^[A-Z0-9.]{3,7}$"},
          "codeType": {"type": "string", "enum": ["ABK", "ABF"], "default": "ABK"}
        }
      }
    },
    "service": {
      "type": "object",
      "description": "Service type and place (situational for referrals)",
      "properties": {
        "serviceType": {
          "type": "string",
          "description": "UM03 - Service Type Code (situational for referrals)",
          "pattern": "^\\d{1,3}$"
        },
        "placeOfService": {
          "type": "string",
          "description": "UM04 - Place of Service Code",
          "pattern": "^\\d{2}$"
        }
      }
    },
    "providerMessage": {
      "type": "string",
      "maxLength": 264,
      "description": "Clinical justification or additional notes"
    },
    "attachmentRequired": {
      "type": "boolean",
      "default": false
    }
  }
}
